# RSB Development Utilities (MODERN + SPEC_ALIGNED)

Updated: 2025-09-15

Purpose
- Provide optional, test-focused utilities to aid development without affecting default builds.
- Enable PTY-backed testing to exercise true interactive/TTY code paths (prompts, colors, terminal sizing).

Feature Flags
- `dev-pty` — Enables `rsb::dev::pty` (pseudo-terminal wrapper built on `portable-pty`). Off by default.

Module Layout (SPEC)
- `src/dev/mod.rs` — Namespace for development utilities (feature-gated, not exported via prelude).
- `src/dev/pty.rs` — Minimal PTY wrapper: spawn under PTY, read/write, resize, wait.

Public API (curated)
```rust
#[cfg(feature = "dev-pty")]
use rsb::dev::{PtyOptions, PtySession, spawn_pty};

#[cfg(feature = "dev-pty")]
{
    let mut sess = spawn_pty("printf ok", &PtyOptions::default()).unwrap();
    let out = sess.read_for(std::time::Duration::from_millis(200)).unwrap();
    assert!(out.contains("ok"));
    let _ = sess.wait();
}
```

Session helpers (`PtySession`)
- `write_all(bytes)` / `writeln(text)` — feed input into the pseudo-terminal.
- `read_for(duration)` — collect output for a bounded window (non-blocking spin helper).
- `resize(cols, rows)` — simulate terminal resizes mid-test.
- `kill()` / `wait()` — terminate or join the underlying child process.

Design Notes
- Gated and non-invasive: default builds don’t include PTY dependencies.
- Preludes: not exported via `rsb::prelude`; import explicitly under the feature.
- Intended primarily for tests/UAT where real TTY behavior is required (prompts, colors, progress redraws).

How to Use
- Enable feature: `cargo test --features dev-pty`
- In tests or local tools, import from `rsb::dev` and orchestrate interactions (write input, read output, resize terminal).
- Combine with existing test runner timeouts (`bin/test.sh`) to ensure stability.

Status
- MODERN: Yes — isolated namespace, curated API, feature-gated.
- SPEC_ALIGNED: Yes — documented, minimal surface, not leaked via prelude.

Future Work
- Add small PTY-backed tests for `visual::prompts` to prove TTY branches.
- Consider optional adapters for other PTY backends behind separate features if needed.

<!-- feat:dev -->

_Generated by bin/feat.py --update-doc._

* `src/dev/mod.rs`
  - pub use pty::* (line 13)

* `src/dev/pty.rs`
  - struct PtyOptions (line 27)
  - struct PtySession (line 43)
  - fn write_all (line 50)
  - fn writeln (line 56)
  - fn read_for (line 63)
  - fn resize (line 90)
  - fn wait (line 102)
  - fn kill (line 108)
  - fn spawn_pty (line 114)

<!-- /feat:dev -->
