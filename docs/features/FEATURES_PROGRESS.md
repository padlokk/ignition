# RSB Progress (MODERN + SPEC_ALIGNED)

Updated: 2025-09-15

Purpose
- Provide a framework‑agnostic, zero‑dependency core for progress reporting.
- Offer terminal reporters and styles suitable for CLI apps.
- Keep the surface curated and feature‑gated to maintain lean defaults.

Feature Flag
- `progress` — enables the progress module (`rsb::progress`). Not enabled by default.

Module Layout (SPEC)
- `src/progress/core.rs` — Core types, events, reporter trait, task lifecycle.
- `src/progress/styles.rs` — Spinner and bar style definitions and helpers.
- `src/progress/terminal.rs` — Terminal reporter (stdout/stderr), rate/ETA rendering.
- `src/progress/manager.rs` — ProgressManager for task orchestration.
- `src/progress/mod.rs` — Curated public API and tiny prelude.

Public API (curated)
```rust
#[cfg(feature = "progress")]
use rsb::progress::{
  ProgressManager, ProgressStyle,
  ProgressReporter, ProgressTask,
  TerminalReporter, TerminalConfig,
};

// Optional convenience prelude
#[cfg(feature = "progress")]
use rsb::progress::prelude::*;
```

Quick Start
```rust
#[cfg(feature = "progress")]
{
    use rsb::progress::{ProgressManager, ProgressStyle};

    let mut progress = ProgressManager::new();
    let task = progress.start_task("Processing files", ProgressStyle::Bar { total: 10 });

    for i in 0..10 {
        task.update(i + 1, &format!("Processing file {}", i + 1));
    }

    task.complete("All files processed");
}
```

Design Notes
- Zero‑dependency core: relies only on `std`.
- Terminal reporter supports:
  - ANSI colors toggled via `TerminalConfig { use_colors: bool, .. }`.
  - Unicode spinners toggled via `use_unicode`.
  - Output stream selection (`use_stderr`).
  - Update throttling (`update_interval_ms`).
  - Clear‑on‑complete behavior.
- No prelude exports: import explicitly to honor prelude policy.
- Logging: for non‑visual diagnostics, prefer `utils::stderrx(level, msg)` in adjacent code. Progress module itself writes directly to chosen stream.

Testing (HOWTO_TEST)
- Unit tests live under the module (`src/progress/mod.rs`) and compile when `--features progress` is enabled.
- Run:
  - `cargo test --features progress`
  - Optionally with visuals for colored output elsewhere: `cargo test --features visuals,progress`
- Test lanes (runner): add as needed (not required for core CI); typical full runs include `./bin/test.sh run all`.

Status
- MODERN: Yes — modularized, curated API, no wildcard exports.
- SPEC_ALIGNED: Yes — feature gated, documented, and tested with unit tests.

### Surface Highlights
- Core types: `ProgressState`, `ProgressEvent`, `ProgressStats`, `ProgressTask`, `ProgressManager`, `SilentReporter`, `MultiStepProgress` describe the lifecycle of tracked work.
- Builders/config: `TaskBuilder`, `ManagerBuilder`, `ProgressStyle`, `SpinnerStyle`, `BarStyle`, `MessagePosition` plus fluent methods (`with_total`, `with_metadata`, `with_auto_cleanup`, `with_config`, `with_prefix`, `with_suffix`, `with_info`, `with_message_position`, `with_edges`, `without_edges`, `with_chars`, `with_width`) shape task output.
- Task ops: `update`, `update_message`, `increment`, `fail`, `cancel`, `current_progress`, `total_progress`, `state`, `message`, `elapsed`, `percentage`, `is_finished`, `supports_updates`, `needs_total` form the primary mutation surface.
- Manager operations: `add_reporter`, `clear_reporters`, `set_enabled`, `is_enabled`, `start_task`, `start_task_with_builder`, `get_task`, `active_tasks`, `remove_task`, `cleanup_finished`, `cancel_all`, `wait_all`, `stats`, `overall_percentage`, `all_complete`, `has_failures` manage reporter lifetimes and aggregate stats (via `ProgressStats`).
- Helpers & UX: `calculate_eta`, `format_duration`, `format_bytes`, `format_rate`, `next_step`, `update_overall`, `main_task`, `current_char`, `encryption_progress`, `multi_file_progress`, `key_rotation_progress`, `simple`, `simple_spinner`, `detailed`, `minimal`, `dots`, `arrow`, `silent`, `disabled`, `auto_select` tailor reporting styles.

<!-- feat:progress -->

_Generated by bin/feat.py --update-doc._

* `src/progress/core.rs`
  - type TaskId (line 12)
  - enum ProgressState (line 16)
  - struct ProgressEvent (line 29)
  - trait ProgressReporter (line 39)
  - struct ProgressTask (line 65)
  - fn update (line 111)
  - fn update_message (line 122)
  - fn increment (line 132)
  - fn complete (line 145)
  - fn fail (line 161)
  - fn cancel (line 172)
  - fn current_progress (line 183)
  - fn total_progress (line 188)
  - fn state (line 193)
  - fn message (line 198)
  - fn id (line 203)
  - fn elapsed (line 208)
  - fn percentage (line 214)
  - fn is_finished (line 226)
  - struct TaskBuilder (line 255)
  - fn new (line 263)
  - fn with_total (line 272)
  - fn with_metadata (line 278)
  - fn calculate_eta (line 298)
  - fn format_duration (line 315)
  - fn format_bytes (line 327)
  - fn format_rate (line 345)

* `src/progress/manager.rs`
  - struct ProgressManager (line 16)
  - fn new (line 25)
  - fn disabled (line 35)
  - fn add_reporter (line 42)
  - fn clear_reporters (line 49)
  - fn set_enabled (line 54)
  - fn is_enabled (line 62)
  - fn start_task (line 67)
  - fn start_task_with_builder (line 93)
  - fn get_task (line 120)
  - fn active_tasks (line 125)
  - fn remove_task (line 136)
  - fn cleanup_finished (line 141)
  - fn cancel_all (line 151)
  - fn wait_all (line 160)
  - fn stats (line 181)
  - struct ProgressStats (line 218)
  - fn overall_percentage (line 230)
  - fn all_complete (line 239)
  - fn has_failures (line 247)
  - struct ManagerBuilder (line 254)
  - fn new (line 262)
  - fn enabled (line 271)
  - fn with_auto_cleanup (line 277)
  - fn build (line 284)
  - struct MultiStepProgress (line 308)
  - fn new (line 323)
  - fn next_step (line 345)
  - fn update_overall (line 359)
  - fn complete (line 384)
  - fn main_task (line 389)

* `src/progress/mod.rs`
  - pub use core::{ProgressEvent, ProgressReporter, ProgressState, ProgressTask} (line 33)
  - pub use manager::ProgressManager (line 34)
  - pub use styles::{BarStyle, ProgressStyle, SpinnerStyle} (line 35)
  - pub use terminal::{TerminalConfig, TerminalReporter} (line 36)

* `src/progress/styles.rs`
  - enum ProgressStyle (line 10)
  - fn total (line 29)
  - fn supports_updates (line 40)
  - fn needs_total (line 45)
  - struct SpinnerStyle (line 72)
  - fn simple (line 96)
  - fn dots (line 105)
  - fn arrow (line 114)
  - fn with_prefix (line 123)
  - fn with_suffix (line 129)
  - fn current_char (line 135)
  - struct BarStyle (line 142)
  - enum MessagePosition (line 164)
  - fn simple (line 195)
  - fn detailed (line 210)
  - fn minimal (line 222)
  - fn with_width (line 237)
  - fn with_chars (line 243)
  - fn with_edges (line 250)
  - fn without_edges (line 256)
  - fn with_info (line 262)
  - fn with_message_position (line 271)
  - fn render (line 277)
  - fn encryption_progress (line 336)
  - fn multi_file_progress (line 341)
  - fn key_rotation_progress (line 346)
  - fn simple_spinner (line 351)
  - fn auto_select (line 356)

* `src/progress/terminal.rs`
  - struct TerminalConfig (line 18)
  - struct TerminalReporter (line 47)
  - fn new (line 66)
  - fn with_config (line 71)
  - fn simple (line 95)
  - fn silent (line 104)
  - struct SilentReporter (line 621)
  - fn new (line 624)

<!-- /feat:progress -->
