# RSB Parse (MODERN + SPEC_ALIGNED)

Updated: 2025-09-15

Purpose
- Provide string/stream “sed-like” transforms in one place.
- Offer a clean adapter for file-based sed helpers without coupling parse to FS.
- Keep macros thin; delegate heavy lifting to `streams` and FS utils per MODULE_SPEC.

Module Layout (SPEC)
- `src/parse/mod.rs` — Orchestrator and curated re-exports.
- `src/parse/macros.rs` — String/stream sed-like macros.
- `src/parse/sed_file.rs` — Adapter over FS for file-based sed helpers.
- `src/parse/utils.rs` — Reserved for future helpers.

Public API (curated)
- String/stream macros:
  - `sed_lines!(content, start, end) -> String`
  - `sed_around!(content, pattern, context) -> String`
  - `sed_insert!(content, sentinel, source) -> String` (errors if sentinel not unique)
  - `sed_template!(content, sentinel, source) -> String`
  - `sed_replace!(source, from, to)`
  - `sed_read!(path, start, end)` — convenience wrapper for reading a slice of a file into memory without mutating it (`FIRST`/`LAST` sentinels supported)
- File-based macros (adapter):
  - `sed_lines_file!(path, start, end) -> String`
  - `sed_around_file!(path, pattern, context) -> String`
  - `sed_insert_file!(path, content, sentinel)`
  - `sed_template_file!(path, content, sentinel)`
  - Under the hood these call `parse::sed_read/lines/around/insert/template`, which return `Result` for better error reporting.
Note: wc-like counters (lines/words/chars for strings and files) are provided by the FS module.

Design Notes
- String/stream macros wrap `rsb::streams::Stream` methods to remain line-wise and memory-aware.
- File-based macros are defined under `parse::macros` and call `parse::sed_file::*`, which in turn wraps `fs::utils`.
- This follows the Cross‑Module Integration pattern: consumer module (parse) owns the adapter to avoid circular deps.
- Behavior is unchanged from legacy macros; only the owning module has changed.

Testing
- Covered by existing stream and FS tests.
- Run:
  - `cargo test`

Status
- MODERN: Yes — macros thin, logic in streams/fs.
- SPEC_ALIGNED: Yes — orchestrator-only `mod.rs`, module-owned macros, adapter in consumer.

<!-- feat:parse -->

_Generated by bin/feat.py --update-doc._

* `src/parse/macros.rs`
  - macro sed_lines! (line 7)
  - macro sed_around! (line 16)
  - macro sed_insert! (line 25)
  - macro sed_template! (line 38)
  - macro sed_replace! (line 47)
  - macro sed_read! (line 58)
  - macro sed_lines_file! (line 75)
  - macro sed_around_file! (line 82)
  - macro sed_insert_file! (line 89)
  - macro sed_template_file! (line 102)

* `src/parse/mod.rs`
  - pub use utils::* (line 6)
  - pub use sed_file::* (line 9)

* `src/parse/sed_file.rs`
  - fn sed_lines_file (line 7)
  - fn sed_around_file (line 15)
  - fn sed_insert_file (line 23)
  - fn sed_template_file (line 31)
  - fn sed_read (line 44)

<!-- /feat:parse -->
