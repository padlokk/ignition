# RSB Host (Environment, XDG/RSB Paths, Script Context)

Updated: 2025-09-12

Purpose
- Discover and standardize host environment for RSB apps (env → Global).
- Provide XDG+ (BashFX v3-aligned) directory keys and ensure required folders exist.
- Surface RSB path namespace derived from XDG+.
- Derive script execution context (SCRIPT_NAME, PATH, DIR, PWD).
- Offer a single bootstrap that sequences all the above.

Imports
```rust
use rsb::hosts;                 // host surfaces
use rsb::global;                // global store/expand/config
use rsb::prelude::*;            // convenient re-exports
```

Core API
- Environment
  - `hosts::import_environment()` — mirror `std::env::vars()` into Global.
  - `hosts::setup_standard_modes()` — map `DEBUG|DEV|QUIET|TRACE` → `*_MODE=1`.
  - `hosts::env_bootstrap()` — import + modes.
  - `hosts::env_to_global()` / `hosts::global_to_env()` — sync helpers.
  - Direct helpers: `hosts::get_env_var(name)`, `set_env_var(name, value)`, `has_env_var(name)`.
- XDG+ (BashFX v3)
  - `hosts::setup_xdg_paths()` — sets:
    - XDG(0): `XDG_CONFIG_HOME`, `XDG_CACHE_HOME` (respects env or uses `$HOME/.config|.cache`).
    - XDG(1): `XDG_HOME` (prefers env `XDG_HOME`, else `$HOME/.local`), then
      `XDG_LIB_HOME`, `XDG_ETC_HOME`, `XDG_BIN_HOME`, and overrides `XDG_DATA_HOME` → `$XDG_HOME/data`.
    - TMP: `XDG_TMP_HOME` (preferred) and back‑compat alias `XDG_TMP` → `$HOME/.cache/tmp` by default.
  - `hosts::ensure_xdg_directories()` — creates `XDG_LIB_HOME`, `XDG_ETC_HOME`, `XDG_BIN_HOME`, `XDG_DATA_HOME`, `XDG_TMP_HOME`.
- RSB paths
  - `hosts::setup_rsb_paths()` — derives `RSB_LIB_HOME`, `RSB_ETC_HOME`, `RSB_DATA_HOME`, `RSB_BIN_HOME` from XDG+.
  - Helpers: `hosts::rsb_tool_path(name)`, `hosts::rsb_config_path(name)`, `hosts::rsb_data_path(name)`.
- Script context
  - `hosts::setup_execution_context(args)` — sets `SCRIPT_NAME`, `SCRIPT_PATH`, `SCRIPT_DIR`, `PWD` from `argv[0]` and `cwd`.
  - Convenience getters: `hosts::get_current_dir()`, `hosts::get_home_dir()`.
- Bootstrap
  - `hosts::bootstrap(args)` — sequences: env → xdg → rsb → mkdir → modes → script → args context (`ARGC`, `ARGV_n`).
  - `hosts::bootstrap_from_env()` — convenience wrapper using `std::env::args()`.
  - `hosts::setup_args_context(args)` — populate `ARGC`/`ARGV_n` without running the full bootstrap (rare use).
- Host→Global composition
  - `hosts::global::hydrate_env_and_configs(&[paths])` — env bootstrap + load config files.
  - `hosts::global::import_env_with_prefix(prefix, strip)` — import only prefixed env vars.
  - Namespace helpers proxy: `hosts::global::{ns_set, ns_get, ns_get_all}`.

Examples
```rust
use rsb::prelude::*;

fn main() {
    let args: Vec<String> = std::env::args().collect();
    rsb::hosts::bootstrap(&args);

    // XDG/RSB
    println!("XDG_HOME={}", global::get_var("XDG_HOME"));
    println!("RSB_BIN_HOME={}", global::get_var("RSB_BIN_HOME"));

    // Script + args context
println!("SCRIPT_NAME={}", global::get_var("SCRIPT_NAME"));
println!("ARGC={}", global::get_var("ARGC"));
}
```

Convenience macros (`rsb::hosts::macros`)
- `get_env!("NAME")`, `hostname!()`, `user!()`, `home_dir!()`, `current_dir!()` — inline accessors powered by the helpers above.
- `host_bootstrap!()` — macro wrapper that runs the full host bootstrap using `std::env::args()`.

System helpers (`rsb::hosts::system`)
- `hosts::get_hostname()`, `get_username()`, `get_arch()`, `get_os()` — machine metadata.
- `hosts::is_command("tool")` — check PATH for a command before invoking it.

RSB path helpers (`rsb::hosts::rsb_path`)
- `hosts::rsb_tool_path("name")`, `rsb_config_path(name)`, `rsb_data_path(name)` — derive namespaced paths rooted in the discovered RSB directories.

Testing & UAT
- Sanity: `tests/sanity/host_env.rs`, `tests/sanity/host_paths.rs` (visible prints).
- Unit: `tests/host_env.rs`, `tests/host_paths.rs`, `tests/host_global.rs`.
- UAT: `tests/uat/host_env.rs`, `tests/uat/host_paths.rs`; runner aliases: `./bin/test.sh run host-env`, `./bin/test.sh run host-paths`.

Notes
- Follows BashFX v3 XDG(1) layout; see `BASHFX-v3.md` and `RSB_BASHFX_ALIGN.md`.
- For virtualization/sandboxes prefer `XDG_HOME` instead of mutating `HOME`.
- Host focuses on discovery and context; business logic and UI belong to CLI/app layers.

<!-- feat:host -->

_Generated by bin/feat.py --update-doc._

* `src/hosts/bootstrap.rs`
  - fn setup_args_context (line 7)
  - fn bootstrap (line 15)
  - fn bootstrap_from_env (line 39)

* `src/hosts/env.rs`
  - fn env_bootstrap (line 8)
  - fn import_environment (line 14)
  - fn setup_standard_modes (line 22)
  - fn get_env_var (line 38)
  - fn set_env_var (line 43)
  - fn has_env_var (line 49)
  - fn env_to_global (line 54)
  - fn global_to_env (line 59)

* `src/hosts/global.rs`
  - fn hydrate_env_and_configs (line 7)
  - fn import_env_with_prefix (line 14)
  - fn ns_set (line 29)
  - fn ns_get (line 32)
  - fn ns_get_all (line 35)

* `src/hosts/host_path.rs`
  - fn get_current_dir (line 7)
  - fn get_home_dir (line 14)

* `src/hosts/macros.rs`
  - macro get_env! (line 8)
  - macro host_bootstrap! (line 16)
  - macro hostname! (line 24)
  - macro user! (line 31)
  - macro home_dir! (line 39)
  - macro current_dir! (line 46)

* `src/hosts/mod.rs`
  - pub use utils::* (line 12)
  - pub use system::* (line 29)

* `src/hosts/rsb_path.rs`
  - fn setup_rsb_paths (line 6)
  - fn rsb_tool_path (line 24)
  - fn rsb_config_path (line 33)
  - fn rsb_data_path (line 42)

* `src/hosts/shell.rs`
  - fn setup_execution_context (line 7)

* `src/hosts/system.rs`
  - fn get_hostname (line 4)
  - fn get_username (line 13)
  - fn get_arch (line 30)
  - fn get_os (line 35)
  - fn is_command (line 40)

* `src/hosts/utils.rs`
  - pub use super::bootstrap::* (line 6)
  - pub use super::env::* (line 7)
  - pub use super::host_path::* (line 8)
  - pub use super::paths::* (line 9)
  - pub use super::rsb_path::* (line 10)
  - pub use super::shell::* (line 11)
  - pub use super::system::* (line 12)
  - pub use super::virt_path::* (line 13)
  - pub use super::xdg_path::* (line 14)

* `src/hosts/xdg_path.rs`
  - fn setup_xdg_paths (line 16)
  - fn ensure_xdg_directories (line 49)

<!-- /feat:host -->
